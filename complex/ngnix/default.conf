# definition of an upstream called "client"
upstream client {
    # it refers to a server that it's hosted at "client:3000"
    server client:3000;
    # 3000 is a default port of react app that was generated by CLI tool
    # remember to end line with ';' semicolon at the end!
}

upstream api {
    server api:5000;
}

# nginx - I want you to be a server:
server {
    listen 80;

    location / {
        proxy_pass http://client;
    }

    # it's specific endpoint on our react js development server (development specific piece of configuration)
    # we could create separate file for nginx production configuration without that part (but that's not needed)
    location /sockjs-node {
        proxy_pass http://client;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
    }

    location /api {
        # rewrite here is used to cut e.g. "/api/values/current" to -> "/values/current" that (api) service understands
        rewrite /api/(.*) /$1 break;
        proxy_pass http://api;
    }
}